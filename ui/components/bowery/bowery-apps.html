<!--
Copyright (c) 2014 Bowery, Inc. All rights reserved.
-->

<!--
`bowery-apps` shows a list of applications and their states.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">
<link rel="import" href="bowery-card.html">
<link rel="import" href="bowery-modal.html">

<polymer-element name="bowery-apps" attributes="token">
  <template>
    <link rel="stylesheet" href="../../bowery/out.css">
    <style>
      .field-group {
        margin: 0;
        padding: 0;
        background: inherit;
      }
      input {
        width: 255px;
        border: none;
        background: none;
      }
      bowery-modal * {
        color: white;
        background:  none;
      }
      label {
        color: rgb(245, 245, 245);
      }
      bowery-card {
        position: relative;
      }
      .status {
        position: absolute;
        right: 18px;
        top: 18px;
        text-align: right;
        text-transform: uppercase;
      }
      bowery-card:hover .status {
        text-decoration: underline;
      }

    </style>
    <div id="container" class="">
      <template repeat="{{app in applications}}">
        <bowery-card data-id="{{app._id}}" on-click="{{goToStatus}}">
          <h4>{{app.name}}</h4>
          <span>{{app.location}}</span>
          <template if="{{app.status == 'running'}}">
            <span class="status ok">ok</span>
          </template>
          <template if="{{app.status == 'provisioning'}}">
            <span class="status provisioning">provisioning</span>
          </template>
          <template if="{{app.status == 'error'}}">
            <span class="status error">error</span>
          </template>
        </bowery-card>
      </template>
    </div>

  <core-ajax id="ajax"
    auto
    url="/applications?token={{token}}"
    on-core-response="{{appsLoaded}}"
    handleAs="json">
  </core-ajax>
  </template>
  <script>
  Polymer('bowery-apps', {
    created: function () {
      this.applications = []
    },
    appsLoaded: function () {
      var response = this.$.ajax.response
      if (response.status == 'found')
        this.applications = response.applications
    },
    goToStatus: function (e) {
      this.fire('bowery-navigate', {path: '/apps/status', app: e.target.dataset.id || e.target.parentNode.dataset.id})
    }

  })
  </script>
</polymer-element>
