<!--
Copyright (c) 2014 Bowery, Inc. All rights reserved.
-->

<!--
`bowery-apps` shows a list of applications and their states.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">
<link rel="import" href="bowery-card.html">

<polymer-element name="bowery-apps" attributes="applications app">
  <template>
    <link rel="stylesheet" href="../../bowery/out.css">
    <style>
      .field-group {
        margin: 0;
        padding: 0;
        background: inherit;
      }
      bowery-card {
        position: relative;
      }
      .status {
        position: absolute;
        right: 18px;
        top: 18px;
        text-align: right;
        text-transform: uppercase;
      }
      bowery-card:hover {
        cursor: pointer;
      }
      .unclickable {
        cursor: text;
        padding: 0 9px 0 0;
      }
      #message {
        display: none;
        padding: 18px;
      }
      .running {
        color: #41C524;
      }
    </style>
    <div id="container" class="">
      <template repeat="{{app in applications}}">
        <bowery-card data-id="{{app._id}}" on-click="{{goToStatus}}">
          <h4>{{app.name}}</h4>
          <span class="unclickable">{{app.location || 'Waiting on AWS for ip address'}}</span>
          <span class="status {{app.status}}">{{app.status}}</span>
        </bowery-card>
      </template>
      <template if="{{applications.length == 0}}">
        <div id="message">
          <h3>Welcome to Bowery</h3>
          <p>Click 'CREATE APP' or drag a folder with your app in it to get started.</p>
          <p>For more info see bowery.io</p>
        </div>
      </template>
    </div>
  </template>
  <script>
  Polymer('bowery-apps', {
    created: function () {
      this.applications = []
    },
    ready: function () {
      var self = this
      setTimeout(function () {
        if (self.$.message)
          self.$.message.style.display = 'block'
      }, 1000)

    },
    goToStatus: function (e) {
      if (e.target.className == 'unclickable')
        return


      var id = e.target.dataset.id || e.target.parentNode.dataset.id
      this.app = this.applications.filter(function (a) {return a._id == id})[0]

      this.fire('bowery-navigate', {path: '/apps/status'})
    }
  })
  </script>
</polymer-element>
