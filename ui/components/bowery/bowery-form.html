<!--
Copyright (c) 2014 Bowery, Inc. All rights reserved.
-->

<!--
`bowery-form` is a bunch of text fields with a submit button.
  <bowery-auth></bowery-auth>

@group Bowery Core Elements
@element bowery-form
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">


<polymer-element name="bowery-form" attributes="fields title endpoint">
<template>
  <link rel="stylesheet" href="../../bowery/out.css">
  <style>
  form {
    margin: 55px auto;
    overflow: auto;
  }

  </style>
  <form id="form">
    <template repeat="{{field in fields}}">
      <div class="field-group">
        <label for="{{field}}">{{field | makeReadable}}</label>
        <input id="{{field}}" type="text" name="{{field}}">
      </div>
    </template>
  </form>

  <bowery-nav type="footer" on-click="{{postForm}}">{{title}}</bowery-nav>
  <core-ajax id="ajax"
    auto
    url="{{endpoint}}"
    method="POST"
    on-core-response="{{emitResult}}"
    handleAs="json">
  </core-ajax>
</template>
<script>
Polymer({
  ready: function () {
    this.fields = this.fields.split(" ")
    console.log(this.fields)
    this.type = "login"
  },
  makeReadable: function (str) {
    strs = str.replace('-', ' ').replace('_', ' ').split(' ')
    return strs.map(function (str) {
      return str.charAt(0).toUpperCase() + str.slice(1)
    }).join(' ')

  },
  postForm: function () {
    var params = {}

    for (var i = 0, field; field = fields[i]; i++)
      params[field] = this.$[field].value

    console.log(params)

    this.$.ajax.params = params
  },
  emitResult: function () {
    this.fire('bowery-form-response', {form: this, response: this.$.ajax.response})
  }
})
</script>
</polymer-element>
